# XVC-Pico OpenOCD Configuration for CVA6 RISC-V Core
# Based on Digilent JTAG-HS2 configuration

# XVC (Xilinx Virtual Cable) interface
#interface xvc
# Default XVC-Pico server runs on localhost:2542
#xvc_url TCP:172.19.0.1:2542

# Alternative: if running XVC-Pico server on different host/port
# xvc_url TCP:172.19.0.1:2542

# JTAG speed - start conservative, can increase if stable
#adapter_khz 1000

# Reset configuration
#reset_config none

# TAP declaration for CVA6
set _CHIPNAME riscv
jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x249511C3

# Target configuration
set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME riscv -chain-position $_TARGETNAME -coreid 0

# GDB configuration
gdb_report_data_abort enable
gdb_report_register_access_error enable

# RISC-V specific timeouts
riscv set_reset_timeout_sec 120
riscv set_command_timeout_sec 120

# Prefer system bus access for better performance
riscv set_prefer_sba on

# Enable RISC-V debug features
riscv set_enable_virtual_priv on

# Memory configuration (adjust based on your CVA6 memory map)
# This should match your ariane_soc memory regions
riscv set_mem_access progbuf sysbus abstract

# Bind to all interfaces for remote GDB connections
bindto 0.0.0.0

# Debug output - remove in production
# debug_level 3

# Dump JTAG chain for verification
scan_chain

# Initialize and halt
init
echo "Attempting to halt the target..."
halt
echo "Ready for Remote Connections on port 3333"
echo "Connect GDB with: target extended-remote localhost:3333"
